(window.webpackJsonp=window.webpackJsonp||[]).push([[539],{891:function(t,n,s){"use strict";s.r(n);var a=s(0),e=Object(a.a)({},(function(){var t=this,n=t._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("存储过程参考")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("CREATE DEFINER=`root`@`localhost` PROCEDURE `gzProc`()\nBEGIN\t\nDECLARE done INT DEFAULT 0;  \nDECLARE i INT DEFAULT 0;  \nDECLARE v_minute int;\nDECLARE starttime time;\nDECLARE endtime time;\nDECLARE mmtime time;\nDECLARE user_id VARCHAR(255);\nDECLARE channel_id VARCHAR(255);\nDECLARE program_name VARCHAR(255);\nDECLARE date date;\nDECLARE duration VARCHAR(2);\nDECLARE cr CURSOR for SELECT t1.user_id,t1.channel_id,t1.program_name,t1.date,t1.starttime,t1.endtime FROM `guizhou_live_data` t1 ORDER BY user_id asc;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;\nOPEN cr;\t\n  FETCH cr INTO user_id,channel_id, program_name,date,starttime,endtime;\t\t\n\tREPEAT  \n-- 从游标中循环取值\n  SET v_minute = floor(UNIX_TIMESTAMP(endtime) - UNIX_TIMESTAMP(starttime))/60 + 1;\n\t   SET i = 0;\n     loop_name:LOOP -- 循环开始\n\t\t\t\t IF i>=v_minute then \n\t\t\t\t\t\t\tLEAVE loop_name;  -- 判断条件成立则结束循环 \n\t\t\t\t END IF;\n\t\t\t\t SET mmtime = FROM_UNIXTIME(UNIX_TIMESTAMP(starttime)+60*i,'%H:%i:00'); -- 设置开始时分\n\t\t\t\t IF i=0 then \n\t\t\t\t\t\t\tSET duration = 60 - DATE_FORMAT(starttime,'%S');\n\t\t\t\t ELSEIF i = v_minute -1 THEN\n\t\t\t\t      SET duration = DATE_FORMAT(endtime,'%S');\n\t\t\t\t ELSE\n\t\t\t\t\t    SET duration = 60;\n\t\t\t\t END IF;\n         INSERT INTO guizhou_live(mmtime,user_id,channel_id,program_name,date,duration)VALUES(mmtime,user_id,channel_id,program_name,date,duration);\n\t\t\t\t SET i=i+1;\n\t\t\tend loop;  -- 循环结束 \t\n\tFETCH NEXT FROM cr INTO user_id,channel_id, program_name,date,starttime,endtime;\n  UNTIL  done = 1\n  END REPEAT; \nCLOSE cr;  \nEND\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[504],{853:function(t,a,s){"use strict";s.r(a);var r=s(0),n=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"arthas-是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arthas-是什么"}},[t._v("#")]),t._v(" Arthas 是什么"),a("a",{attrs:{href:"https://www.cnblogs.com/54chensongxia/p/11452740.html#1-arthas-%E6%98%AF%E4%BB%80%E4%B9%88",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Arthas是一款阿里巴巴开源的 Java 线上诊断工具，功能非常强大，可以解决很多线上不方便解决的问题。")]),t._v(" "),a("p",[t._v("Arthas诊断使用的是命令行交互模式，支持JDK6+，Linux、Mac、Windows 操作系统，命令还支持使用 tab 键对各种信息的自动补全，诊断起来非常方便。")]),t._v(" "),a("p",[t._v("这是它的官方网站：")]),t._v(" "),a("blockquote",[a("p",[t._v("https://alibaba.github.io/arthas/index.html")])]),t._v(" "),a("p",[t._v("Github地址：")]),t._v(" "),a("blockquote",[a("p",[t._v("https://github.com/alibaba/arthas")])]),t._v(" "),a("h2",{attrs:{id:"arthas能解决什么问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arthas能解决什么问题"}},[t._v("#")]),t._v(" Arthas能解决什么问题"),a("a",{attrs:{href:"https://www.cnblogs.com/54chensongxia/p/11452740.html#2-arthas%E8%83%BD%E8%A7%A3%E5%86%B3%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("看下Arthas的官方说明")]),t._v(" "),a("blockquote",[a("p",[t._v("当你遇到以下类似问题而束手无策时，Arthas可以帮助你解决：\n1、这个类从哪个 jar 包加载的？为什么会报各种类相关的 Exception？\n2、我改的代码为什么没有执行到？难道是我没 commit？分支搞错了？\n3、遇到问题无法在线上 debug，难道只能通过加日志再重新发布吗？\n4、线上遇到某个用户的数据处理有问题，但线上同样无法 debug，线下无法重现！\n5、是否有一个全局视角来查看系统的运行状况？\n6、有什么办法可以监控到JVM的实时运行状态？")])]),t._v(" "),a("p",[t._v("看完是不是觉得太牛逼了？"),a("strong",[t._v("特别是它可以在线反编译类，可以不用加日志在线调试跟踪问题代码。")])]),t._v(" "),a("h2",{attrs:{id:"快速安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速安装"}},[t._v("#")]),t._v(" 快速安装"),a("a",{attrs:{href:"https://www.cnblogs.com/54chensongxia/p/11452740.html#3-%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("官方推荐使用 "),a("code",[t._v("arthas-boot")]),t._v(" 进行安装，非常方便，以下是基于 Linux 系统环境进行演示，一般解决线上问题也是基于 Linux 环境。")]),t._v(" "),a("h3",{attrs:{id:"第一步-下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一步-下载"}},[t._v("#")]),t._v(" 第一步：下载"),a("a",{attrs:{href:"https://www.cnblogs.com/54chensongxia/p/11452740.html#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E4%B8%8B%E8%BD%BD",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("在任何目录下载 "),a("code",[t._v("arthas-boot")]),t._v(" 这个包。")]),t._v(" "),a("blockquote",[a("p",[t._v("wget https://alibaba.github.io/arthas/arthas-boot.jar")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@VM_0_7_centos ~]# wget https://alibaba.github.io/arthas/arthas-boot.jar\n--2019-07-30 14:48:31--  https://alibaba.github.io/arthas/arthas-boot.jar\nResolving alibaba.github.io (alibaba.github.io)... 185.199.108.153, 185.199.109.153, 185.199.110.153, ...\nConnecting to alibaba.github.io (alibaba.github.io)|185.199.108.153|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 98637 (96K) [application/java-archive]\nSaving to: ‘arthas-boot.jar’\n\n100%[==========================================================================================================>] 98,637      32.8KB/s   in 2.9s   \n\n2019-07-30 14:48:36 (32.8 KB/s) - ‘arthas-boot.jar’ saved [98637/98637]\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h3",{attrs:{id:"第二步-运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二步-运行"}},[t._v("#")]),t._v(" 第二步：运行"),a("a",{attrs:{href:"https://www.cnblogs.com/54chensongxia/p/11452740.html#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E8%BF%90%E8%A1%8C",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("java -jar")]),t._v(" 命令执行 "),a("code",[t._v("arthas-boot")]),t._v(" 包。（如果运行失败，建议进行全量安装arthas，参考"),a("a",{attrs:{href:"https://alibaba.github.io/arthas/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档"),a("OutboundLink")],1),t._v("中的全量安装章节）")]),t._v(" "),a("blockquote",[a("p",[t._v("java -jar arthas-boot.jar")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[INFO] arthas-boot version: 3.1.1\n[INFO] Found existing java process, please choose one and hit RETURN.\n* [1]: 13062 spring-boot-best-practice-0.0.1-SNAPSHOT.jar\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h3",{attrs:{id:"第三步-选择进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三步-选择进程"}},[t._v("#")]),t._v(" 第三步：选择进程"),a("a",{attrs:{href:"https://www.cnblogs.com/54chensongxia/p/11452740.html#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E9%80%89%E6%8B%A9%E8%BF%9B%E7%A8%8B",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("运行 "),a("code",[t._v("arthas-boot")]),t._v(" 后，控制台会显示所有 Java 进程，选择一个你需要诊断的进程。")]),t._v(" "),a("p",[t._v("如第二步所示，这里有只有一个 Java 进程，输入序号1，回车，Arthas会附到目标进程上，并输出日志：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[INFO] Start download arthas from remote server: https://maven.aliyun.com/repository/public/com/taobao/arthas/arthas-packaging/3.1.1/arthas-packaging-3.1.1-bin.zip\n[INFO] Download arthas success.\n[INFO] arthas home: /root/.arthas/lib/3.1.1/arthas\n[INFO] Try to attach process 13062\n[INFO] Attach process 13062 success.\n[INFO] arthas-client connect 127.0.0.1 3658\n  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.                           \n /  O   |  .--. ''--.  .--'|  '--'  | /  O   '   .-'                          \n|  .-.  ||  '--'.'   |  |   |  .--.  ||  .-.  |`.  `-.                          \n|  | |  ||  |      |  |   |  |  |  ||  | |  |.-'    |                         \n`--' `--'`--' '--'   `--'   `--'  `--'`--' `--'`-----'                          \n\n\nwiki      https://alibaba.github.io/arthas                                      \ntutorials https://alibaba.github.io/arthas/arthas-tutorials                     \nversion   3.1.1                                                                 \npid       13062                                                                 \ntime      2019-07-30 14:49:34\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("p",[t._v("至此，安装、启动完成。")]),t._v(" "),a("p",[t._v("更多其他安装方式见：https://alibaba.github.io/arthas/install-detail.html")]),t._v(" "),a("h2",{attrs:{id:"实战使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实战使用"}},[t._v("#")]),t._v(" 实战使用"),a("a",{attrs:{href:"https://www.cnblogs.com/54chensongxia/p/11452740.html#4-%E5%AE%9E%E6%88%98%E4%BD%BF%E7%94%A8",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("启动完成后，当前光标会进入 arthas 的控制台，接受各种操作命令。")]),t._v(" "),a("p",[t._v("下面，栈长会做几个常用命令的演示，让大家对它有一个基本的认识和快速上手的能力。")]),t._v(" "),a("p",[a("strong",[t._v("1、dashboard")]),t._v("\n显示当前系统的实时数据面板，按 ctrl+c 即可退出。")]),t._v(" "),a("blockquote",[a("p",[t._v("$ dashboard")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903192337433-1664864165.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903192337433-1664864165.png",alt:"dashboard"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[a("strong",[t._v("2. thread")]),t._v("\n查看当前 JVM 的线程堆栈信息。")]),t._v(" "),a("p",[t._v("thread id， 显示指定线程的运行堆栈：")]),t._v(" "),a("blockquote",[a("p",[t._v("$ thread 20")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903192602959-614137269.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903192602959-614137269.png",alt:"img"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("显示当前最忙的前N个线程并打印堆栈：")]),t._v(" "),a("blockquote",[a("p",[t._v("$ thread -n 3")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903192646655-1452858456.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903192646655-1452858456.png",alt:"img"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[a("strong",[t._v("3. sc")]),t._v("\n查看 JVM 已加载的类详细信息。")]),t._v(" "),a("blockquote",[a("p",[t._v("$ sc -d *Test")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903192818807-752171448.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903192818807-752171448.png",alt:"img"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[a("strong",[t._v("4. sm")]),t._v("\n查看已加载类的方法信息。")]),t._v(" "),a("blockquote",[a("p",[t._v("$ sm -d cn.javastack.springbootbestpractice.SpringBootBestPracticeApplication main")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903192921245-626516985.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903192921245-626516985.png",alt:"img"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[a("strong",[t._v("5. jad")]),t._v("\n反编译指定已加载类的源代码。")]),t._v(" "),a("blockquote",[a("p",[t._v("$ jad cn.javastack.springbootbestpractice.SpringBootBestPracticeApplication")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193003348-493017462.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193003348-493017462.png",alt:"img"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[a("strong",[t._v("6. trace")]),t._v("\n显示方法内部调用路径，非实时返回的命令并输出方法路径上的总耗时，以及的每个节点上的详细耗时。")]),t._v(" "),a("blockquote",[a("p",[t._v("$ trace -j cn.javastack.springbootbestpractice.web.JsonTest getUserInfo")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193050981-1023862318.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193050981-1023862318.png",alt:"img"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[a("strong",[t._v("7. monitor")]),t._v("\n对某个方法的调用进行定时监控。")]),t._v(" "),a("blockquote",[a("p",[t._v("$ monitor cn.javastack.springbootbestpractice.web.JsonTest getUserInfo -c 5")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193156853-640626831.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193156853-640626831.png",alt:"img"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("-c 5：表示每5秒统计一次，统计周期，默认值为120秒。")]),t._v(" "),a("p",[t._v("监控维度说明：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193311540-712284119.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193311540-712284119.png",alt:"img"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[a("strong",[t._v("8. watch")]),t._v("\n观测方法执行数据，能方便的观察到指定方法的调用情况，如：返回值、抛出异常、入参等。")]),t._v(" "),a("blockquote",[a("p",[t._v("$ watch cn.javastack.springbootbestpractice.web.JsonTest getUserInfo '{params, returnObj}' -x 2 -b")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193415711-302319223.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193415711-302319223.png",alt:"img"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("以上监控的是一个方法的入参情况，在方法执行前监控：-b，遍历深度：-x 2。")]),t._v(" "),a("p",[a("strong",[t._v("9. quit/exit")]),t._v("\n退出当前 Arthas。")]),t._v(" "),a("p",[t._v("这个命令仅退出当前连接的客户端，附到目标进程上的 Arthas 会继续运行，端口不会关闭，下次连接时可以直接连接使用。")]),t._v(" "),a("p",[a("strong",[t._v("10. shutdown")]),t._v("\n关闭 Arthas 服务端，退出所有 Arthas 客户端。")]),t._v(" "),a("p",[t._v("以上演示了 10 个命令的基本使用，各种命令的使用详情可以在命令带 --help 进行查阅。\n"),a("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193542899-2089812885.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1775037/201909/1775037-20190903193542899-2089812885.png",alt:"img"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("更多其他命令请参考：")]),t._v(" "),a("blockquote",[a("p",[t._v("https://alibaba.github.io/arthas/commands.html")])]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结"),a("a",{attrs:{href:"https://www.cnblogs.com/54chensongxia/p/11452740.html#5-%E6%80%BB%E7%BB%93",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("总结下来，使用 Arthas 可以很方便的诊断一个 Java 应用程序，如：系统数据面板、JVM实时运行状态、类加载情况、监控方法执行情况、显示方法执行路径等。")]),t._v(" "),a("p",[t._v("Arthas这些实用的功能确实可以帮助我们解决一些常见的线上问题，也能独立于应用程序代码，但仅局限于在一个 JVM 进程内，如果是分布式系统，Arthas就有点难了。")])])}),[],!1,null,null,null);a.default=n.exports}}]);